var _ = require('lodash')._;
var models = require('model/models');

function success(successCallback, next) {
    return function(err, result) {
        if (err) {
            next(err);
        } else {
            successCallback(result);
        }
    };
}

module.exports = {
    createCode: function(req, res, next) {
        var code = new models.AccessTokenCode(req.body);
        var codeRepository = this.get('repository.code');
        codeRepository.save(code, success(function() {
            res.send(JSON.stringify(code.get('value')));
        }, next));
    }
};