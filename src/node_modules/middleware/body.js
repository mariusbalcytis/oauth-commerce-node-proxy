

exports = module.exports = function(){
    return function json(req, res, next) {
        if (req._body) return next();
        req.body = req.body || '';
        if (!('transfer-encoding' in req.headers || 'content-length' in req.headers)) return next();
        req._body = true;

        var buf = '';
        req.setEncoding('binary');
        req.on('data', function(chunk){ buf += chunk });
        req.on('end', function(){
            req.body = buf;
            next();
        });
    };
};
