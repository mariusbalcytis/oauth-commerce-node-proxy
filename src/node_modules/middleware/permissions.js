var _ = require('lodash')._;
var errors = require('../lib/errors');

module.exports = function(permissions) {
    return function(req, res, next) {
        if (!req.credentials) {
            next(new errors.ApiError('unauthorized', 'No authorization header was found'));
        } else {
            var err = null;
            _.each(permissions, function(permission) {
                if (!req.credentials.hasPermission(permission)) {
                    err = new errors.ApiError('access_denied', 'No needed permissions');
                    return false;
                }
            });
            next(err);
        }
    };
};