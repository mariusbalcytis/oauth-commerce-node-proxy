var crypto = require('crypto');

var generateRandomString = function(size, callback) {
    crypto.randomBytes(size, function(err, buffer) {
        if (err) {
            callback(err);
            return;
        }

        var randomString = '';
        for (var i = 0; i < buffer.length; i++) {
            var c = buffer[i];
            if (c >= 248) {
                continue;
            }
            c = c % 62;
            c = c < 10 ? c + 48 : (c < 36 ? c - 10 + 65: c - 36 + 97);
            randomString += String.fromCharCode(c);
        }
        var needMore = size - randomString.length;
        if (needMore > 0) {
            generateRandomString(needMore, function(err, remainder) {
                if (err) {
                    callback(err);
                } else {
                    callback(null, randomString + remainder);
                }
            });
        } else {
            callback(null, randomString);
        }
    });
};

module.exports = {
    generateRandomString: generateRandomString
};